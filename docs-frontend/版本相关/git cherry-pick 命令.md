# git cherry-pick 命令

`git cherry-pick` 命令的**核心作用**是：**将某个分支上的一个或多个特定提交（commit）所做的更改，重新应用到当前分支上**。

你可以把它想象成“精挑细选”某些提交，把它们“摘”过来，而不是把整个分支合并过来。

---

### 基本语法和用法

#### 1. 挑选单个提交
这是最常用的形式。

```bash
git cherry-pick <commit-hash>
```
*   `<commit-hash>` 是你要应用的提交的哈希值（通常是一长串字符，取前7位就足够）。你可以使用 `git log` 在源分支上查看提交历史并找到这个哈希值。

**工作流程：**
1.  首先，**切换到你想应用更改的目标分支**（例如 `main` 或 `develop`）。
    ```bash
    git checkout main
    ```
2.  然后，执行 `cherry-pick` 命令，指定你想“摘”过来的那个提交的哈希值。
    ```bash
    git cherry-pick a1b2c3d
    ```
3.  执行成功后，这个提交的更改就会被应用到你的当前分支 (`main`)，并且 Git 会自动创建一个新的提交。这个**新提交的内容和原提交一样，但哈希值会不同**（因为父提交、作者日期等都变了）。

#### 2. 挑选多个提交
你可以一次挑选多个连续的或不连续的提交。

*   **连续的一系列提交**（不包含起始提交本身）：
    ```bash
    git cherry-pick <start-commit-hash>^..<end-commit-hash>
    ```
    *   使用 `^` 或 `~` 来指明范围包含起始提交。例如，要应用从提交 `A` 到提交 `D` 的所有更改（包括A和D）：
    ```bash
    git cherry-pick A^..D
    # 或者
    git cherry-pick A~..D
    ```

*   **不连续的多个提交**：只需将它们的哈希值依次列出，用空格隔开。
    ```bash
    git cherry-pick <commit-hash-1> <commit-hash-2> <commit-hash-3>
    ```

---

### 常用选项和参数

`cherry-pick` 在执行过程中可能会遇到冲突，或者你可能有其他需求，这时这些选项就非常有用：

*   `-n` / `--no-commit`：**只应用更改，但不自动创建提交**。
    *   这允许你检查更改，或者将多个提交的更改合并成一个后再自己提交。
    *   ```bash
        git cherry-pick -n a1b2c3d
        # 检查文件，确认无误后手动提交
        git commit -m "手动合并了某个功能"
        ```

*   `-x`：在自动生成的提交信息中**附加一行 `(cherry picked from commit ...)`**，说明这个提交是从哪里摘来的。这对于跟踪记录非常有用，尤其是在多人协作中。

*   `-s` / `--signoff`：在提交信息的末尾追加**Signed-off-by**行（由提交者签名）。常用于一些需要DCO（开发者证书）的项目。

*   **处理冲突**：
    *   如果在 `cherry-pick` 过程中发生冲突，Git 会停止并告诉你冲突的文件。
    *   你需要**手动解决冲突**（编辑文件，选择要保留的代码）。
    *   解决后，用 `git add <file-name>` 标记冲突已解决。
    *   然后，你有两个选择：
        *   **继续**完成 `cherry-pick`：`git cherry-pick --continue`
        *   **放弃**本次 `cherry-pick`（回到操作前的状态）：`git cherry-pick --abort`

---

### 典型应用场景

1.  **修复bug**：一个bug在 `develop` 分支上被修复了（提交 `abc123`），但你现在需要立刻把它应用到上线的 `main` 分支上，而不想合并整个 `develop` 分支。
    ```bash
    git checkout main
    git cherry-pick abc123
    ```

2.  **误提交到错误的分支**：你本来应该在 `feature/login` 分支上开发，但不小心把几个提交做到了 `main` 分支上。这时可以：
    *   在 `main` 分支上用 `git log` 找到误提交的哈希值（例如 `a1b2c3d` 和 `e4f5g6h`）。
    *   切换到正确的功能分支：`git checkout feature/login`
    *   把这些提交“摘”过来：`git cherry-pick a1b2c3d e4f5g6h`
    *   最后回到 `main` 分支，用 `git reset` 回退掉那些误提交。

3.  **只想应用某个功能的部分提交**：一个功能分支有20个提交，但你只想把其中最关键的两个改动（例如一个逻辑优化和一个UI调整）先合并到主分支。

---

### 注意事项

*   **不是合并的替代品**：`cherry-pick` 主要用于挑选独立的、零散的提交。对于集成一整个功能的所有历史，使用 `git merge` 或 `git rebase` 更合适。
*   **可能产生重复提交**：如果你之后又合并了被 `cherry-pick` 过的整个分支，Git 可能会因为提交历史不同而误以为那些更改是新的，导致冲突或重复。使用 `-x` 选项可以在一定程度上帮助避免这个问题。
*   **谨慎使用**：因为它会重写提交历史（创建新的提交），在共享分支上大量使用可能会给协作带来混乱。

希望这个解释对你有帮助！`cherry-pick` 是一个需要练习的命令，多用几次就熟悉了。